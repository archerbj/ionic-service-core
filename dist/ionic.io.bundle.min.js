!function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){!function(e,r){"function"==typeof define&&define.amd?define([],r):"object"==typeof n?t.exports=r():e.returnExports=r()}(this,function(){function e(i,o){if("function"!=typeof o)throw new Error("Bad callback given: "+o);if(!i)throw new Error("No options given");var s=i.onResponse;if(i="string"==typeof i?{uri:i}:JSON.parse(JSON.stringify(i)),i.onResponse=s,i.verbose&&(e.log=r()),i.url&&(i.uri=i.url,delete i.url),!i.uri&&""!==i.uri)throw new Error("options.uri is a required argument");if("string"!=typeof i.uri)throw new Error("options.uri must be a string");for(var u=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],c=0;c<u.length;c++)if(i[u[c]])throw new Error("options."+u[c]+" is not supported");if(i.callback=o,i.method=i.method||"GET",i.headers=i.headers||{},i.body=i.body||null,i.timeout=i.timeout||e.DEFAULT_TIMEOUT,i.headers.host)throw new Error("Options.headers.host is not supported");i.json&&(i.headers.accept=i.headers.accept||"application/json","GET"!==i.method&&(i.headers["content-type"]="application/json"),"boolean"!=typeof i.json?i.body=JSON.stringify(i.json):"string"!=typeof i.body&&(i.body=JSON.stringify(i.body)));var l=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")};if(i.qs){var f="string"==typeof i.qs?i.qs:l(i.qs);-1!==i.uri.indexOf("?")?i.uri=i.uri+"&"+f:i.uri=i.uri+"?"+f}var d=function(e){var t={};t.boundry="-------------------------------"+Math.floor(1e9*Math.random());var n=[];for(var r in e)e.hasOwnProperty(r)&&n.push("--"+t.boundry+'\nContent-Disposition: form-data; name="'+r+'"\n\n'+e[r]+"\n");return n.push("--"+t.boundry+"--"),t.body=n.join(""),t.length=t.body.length,t.type="multipart/form-data; boundary="+t.boundry,t};if(i.form){if("string"==typeof i.form)throw"form name unsupported";if("POST"===i.method){var h=(i.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(i.headers["content-type"]=h,h){case"application/x-www-form-urlencoded":i.body=l(i.form).replace(/%20/g,"+");break;case"multipart/form-data":var p=d(i.form);i.body=p.body,i.headers["content-type"]=p.type;break;default:throw new Error("unsupported encoding:"+h)}}}return i.onResponse=i.onResponse||n,i.onResponse===!0&&(i.onResponse=o,i.callback=n),!i.headers.authorization&&i.auth&&(i.headers.authorization="Basic "+a(i.auth.username+":"+i.auth.password)),t(i)}function t(t){function n(){f=!0;var n=new Error("ETIMEDOUT");return n.code="ETIMEDOUT",n.duration=t.timeout,e.log.error("Timeout",{id:l._id,milliseconds:t.timeout}),t.callback(n,l)}function r(n){if(f)return e.log.debug("Ignoring timed out state change",{state:l.readyState,id:l.id});if(e.log.debug("State change",{state:l.readyState,id:l.id,timed_out:f}),l.readyState===s.OPENED){e.log.debug("Request started",{id:l.id});for(var r in t.headers)l.setRequestHeader(r,t.headers[r])}else l.readyState===s.HEADERS_RECEIVED?i():l.readyState===s.LOADING?(i(),a()):l.readyState===s.DONE&&(i(),a(),u())}function i(){if(!g.response){if(g.response=!0,e.log.debug("Got response",{id:l.id,status:l.status}),clearTimeout(l.timeoutTimer),l.statusCode=l.status,d&&0==l.statusCode){var n=new Error("CORS request rejected: "+t.uri);return n.cors="rejected",g.loading=!0,g.end=!0,t.callback(n,l)}t.onResponse(null,l)}}function a(){g.loading||(g.loading=!0,e.log.debug("Response body loading",{id:l.id}))}function u(){if(!g.end){if(g.end=!0,e.log.debug("Request done",{id:l.id}),l.body=l.responseText,t.json)try{l.body=JSON.parse(l.responseText)}catch(n){return t.callback(n,l)}t.callback(null,l,l.body)}}var l=new s,f=!1,d=o(t.uri),h="withCredentials"in l;if(c+=1,l.seq_id=c,l.id=c+": "+t.method+" "+t.uri,l._id=l.id,d&&!h){var p=new Error("Browser does not support cross-origin request: "+t.uri);return p.cors="unsupported",t.callback(p,l)}l.timeoutTimer=setTimeout(n,t.timeout);var g={response:!1,loading:!1,end:!1};return l.onreadystatechange=r,l.open(t.method,t.uri,!0),d&&(l.withCredentials=!!t.withCredentials),l.send(t.body),l}function n(){}function r(){var e,t,r={},o=["trace","debug","info","warn","error"];for(t=0;t<o.length;t++)e=o[t],r[e]=n,"undefined"!=typeof console&&console&&console[e]&&(r[e]=i(console,e));return r}function i(e,t){function n(n,r){return"object"==typeof r&&(n+=" "+JSON.stringify(r)),e[t].call(e,n)}return n}function o(e){var t,n=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{t=location.href}catch(r){t=document.createElement("a"),t.href="",t=t.href}var i=n.exec(t.toLowerCase())||[],o=n.exec(e.toLowerCase()),a=!(!o||o[1]==i[1]&&o[2]==i[2]&&(o[3]||("http:"===o[1]?80:443))==(i[3]||("http:"===i[1]?80:443)));return a}function a(e){var t,n,r,i,o,a,s,u,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,f=0,d="",h=[];if(!e)return e;do t=e.charCodeAt(l++),n=e.charCodeAt(l++),r=e.charCodeAt(l++),u=t<<16|n<<8|r,i=u>>18&63,o=u>>12&63,a=u>>6&63,s=63&u,h[f++]=c.charAt(i)+c.charAt(o)+c.charAt(a)+c.charAt(s);while(l<e.length);switch(d=h.join(""),e.length%3){case 1:d=d.slice(0,-2)+"==";break;case 2:d=d.slice(0,-1)+"="}return d}var s=XMLHttpRequest;if(!s)throw new Error("missing XMLHttpRequest");e.log={trace:n,debug:n,info:n,warn:n,error:n};var u=18e4,c=0;e.withCredentials=!1,e.DEFAULT_TIMEOUT=u,e.defaults=function(t,n){var r=function(e){var n=function(n,r){n="string"==typeof n?{uri:n}:JSON.parse(JSON.stringify(n));for(var i in t)void 0===n[i]&&(n[i]=t[i]);return e(n,r)};return n},i=r(e);return i.get=r(e.get),i.post=r(e.post),i.put=r(e.put),i.head=r(e.head),i};var l=["get","put","post","head"];return l.forEach(function(t){var n=t.toUpperCase(),r=t.toLowerCase();e[r]=function(t){"string"==typeof t?t={method:n,uri:t}:(t=JSON.parse(JSON.stringify(t)),t.method=n);var r=[t].concat(Array.prototype.slice.apply(arguments,[1]));return e.apply(this,r)}}),e.couch=function(t,r){function i(e,t,n){if(e)return r(e,t,n);if((t.statusCode<200||t.statusCode>299)&&n.error){e=new Error("CouchDB error: "+(n.error.reason||n.error.error));for(var i in n)e[i]=n[i];return r(e,t,n)}return r(e,t,n)}"string"==typeof t&&(t={uri:t}),t.json=!0,t.body&&(t.json=t.body),delete t.body,r=r||n;var o=e(t,i);return o},e})},{}],2:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!o(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,o,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],s(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,o=new Array(r-1),u=1;r>u;u++)o[u-1]=arguments[u];n.apply(this,o)}else if(a(n)){for(r=arguments.length,o=new Array(r-1),u=1;r>u;u++)o[u-1]=arguments[u];for(c=n.slice(),r=c.length,u=0;r>u;u++)c[u].apply(this,o)}return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned){var n;n=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,o,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(n)){for(s=o;s-->0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(0>r)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?i(e._events[t])?1:e._events[t].length:0}},{}],3:[function(e,t,n){function r(){l=!1,s.length?c=s.concat(c):f=-1,c.length&&i()}function i(){if(!l){var e=setTimeout(r);l=!0;for(var t=c.length;t;){for(s=c,c=[];++f<t;)s[f].run();f=-1,t=c.length}s=null,l=!1,clearTimeout(e)}}function o(e,t){this.fun=e,this.array=t}function a(){}var s,u=t.exports={},c=[],l=!1,f=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new o(e,t)),1!==c.length||l||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=a,u.addListener=a,u.once=a,u.off=a,u.removeListener=a,u.removeAllListeners=a,u.emit=a,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],4:[function(e,t,n){(function(n,r){(function(){"use strict";function i(e){return"function"==typeof e||"object"==typeof e&&null!==e}function o(e){return"function"==typeof e}function a(e){return"object"==typeof e&&null!==e}function s(e){H=e}function u(e){Y=e}function c(){return function(){n.nextTick(p)}}function l(){return function(){z(p)}}function f(){var e=0,t=new W(p),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function d(){var e=new MessageChannel;return e.port1.onmessage=p,function(){e.port2.postMessage(0)}}function h(){return function(){setTimeout(p,1)}}function p(){for(var e=0;V>e;e+=2){var t=te[e],n=te[e+1];t(n),te[e]=void 0,te[e+1]=void 0}V=0}function g(){try{var t=e,n=t("vertx");return z=n.runOnLoop||n.runOnContext,l()}catch(r){return h()}}function v(){}function y(){return new TypeError("You cannot resolve a promise with itself")}function _(){return new TypeError("A promises callback cannot return that same promise.")}function m(e){try{return e.then}catch(t){return oe.error=t,oe}}function k(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function b(e,t,n){Y(function(e){var r=!1,i=k(n,t,function(n){r||(r=!0,t!==n?P(e,n):E(e,n))},function(t){r||(r=!0,C(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,C(e,i))},e)}function w(e,t){t._state===re?E(e,t._result):t._state===ie?C(e,t._result):S(t,void 0,function(t){P(e,t)},function(t){C(e,t)})}function I(e,t){if(t.constructor===e.constructor)w(e,t);else{var n=m(t);n===oe?C(e,oe.error):void 0===n?E(e,t):o(n)?b(e,t,n):E(e,t)}}function P(e,t){e===t?C(e,y()):i(t)?I(e,t):E(e,t)}function T(e){e._onerror&&e._onerror(e._result),O(e)}function E(e,t){e._state===ne&&(e._result=t,e._state=re,0!==e._subscribers.length&&Y(O,e))}function C(e,t){e._state===ne&&(e._state=ie,e._result=t,Y(T,e))}function S(e,t,n,r){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+re]=n,i[o+ie]=r,0===o&&e._state&&Y(O,e)}function O(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r,i,o=e._result,a=0;a<t.length;a+=3)r=t[a],i=t[a+n],r?A(n,r,i,o):i(o);e._subscribers.length=0}}function j(){this.error=null}function x(e,t){try{return e(t)}catch(n){return ae.error=n,ae}}function A(e,t,n,r){var i,a,s,u,c=o(n);if(c){if(i=x(n,r),i===ae?(u=!0,a=i.error,i=null):s=!0,t===i)return void C(t,_())}else i=r,s=!0;t._state!==ne||(c&&s?P(t,i):u?C(t,a):e===re?E(t,i):e===ie&&C(t,i))}function R(e,t){try{t(function(t){P(e,t)},function(t){C(e,t)})}catch(n){C(e,n)}}function D(e,t){var n=this;n._instanceConstructor=e,n.promise=new e(v),n._validateInput(t)?(n._input=t,n.length=t.length,n._remaining=t.length,n._init(),0===n.length?E(n.promise,n._result):(n.length=n.length||0,n._enumerate(),0===n._remaining&&E(n.promise,n._result))):C(n.promise,n._validationError())}function L(e){return new se(this,e).promise}function N(e){function t(e){P(i,e)}function n(e){C(i,e)}var r=this,i=new r(v);if(!B(e))return C(i,new TypeError("You must pass an array to race.")),i;for(var o=e.length,a=0;i._state===ne&&o>a;a++)S(r.resolve(e[a]),void 0,t,n);return i}function q(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(v);return P(n,e),n}function M(e){var t=this,n=new t(v);return C(n,e),n}function U(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function $(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function G(e){this._id=de++,this._state=void 0,this._result=void 0,this._subscribers=[],v!==e&&(o(e)||U(),this instanceof G||$(),R(this,e))}function F(){var e;if("undefined"!=typeof r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;(!n||"[object Promise]"!==Object.prototype.toString.call(n.resolve())||n.cast)&&(e.Promise=he)}var J;J=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var z,H,K,B=J,V=0,Y=({}.toString,function(e,t){te[V]=e,te[V+1]=t,V+=2,2===V&&(H?H(p):K())}),X="undefined"!=typeof window?window:void 0,Q=X||{},W=Q.MutationObserver||Q.WebKitMutationObserver,Z="undefined"!=typeof n&&"[object process]"==={}.toString.call(n),ee="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,te=new Array(1e3);K=Z?c():W?f():ee?d():void 0===X&&"function"==typeof e?g():h();var ne=void 0,re=1,ie=2,oe=new j,ae=new j;D.prototype._validateInput=function(e){return B(e)},D.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},D.prototype._init=function(){this._result=new Array(this.length)};var se=D;D.prototype._enumerate=function(){for(var e=this,t=e.length,n=e.promise,r=e._input,i=0;n._state===ne&&t>i;i++)e._eachEntry(r[i],i)},D.prototype._eachEntry=function(e,t){var n=this,r=n._instanceConstructor;a(e)?e.constructor===r&&e._state!==ne?(e._onerror=null,n._settledAt(e._state,t,e._result)):n._willSettleAt(r.resolve(e),t):(n._remaining--,n._result[t]=e)},D.prototype._settledAt=function(e,t,n){var r=this,i=r.promise;i._state===ne&&(r._remaining--,e===ie?C(i,n):r._result[t]=n),0===r._remaining&&E(i,r._result)},D.prototype._willSettleAt=function(e,t){var n=this;S(e,void 0,function(e){n._settledAt(re,t,e)},function(e){n._settledAt(ie,t,e)})};var ue=L,ce=N,le=q,fe=M,de=0,he=G;G.all=ue,G.race=ce,G.resolve=le,G.reject=fe,G._setScheduler=s,G._setAsap=u,G._asap=Y,G.prototype={constructor:G,then:function(e,t){var n=this,r=n._state;if(r===re&&!e||r===ie&&!t)return this;var i=new this.constructor(v),o=n._result;if(r){var a=arguments[r-1];Y(function(){A(r,i,a,o)})}else S(n,i,e,t);return i},"catch":function(e){return this.then(null,e)}};var pe=F,ge={Promise:he,polyfill:pe};"function"==typeof define&&define.amd?define(function(){return ge}):"undefined"!=typeof t&&t.exports?t.exports=ge:"undefined"!=typeof this&&(this.ES6Promise=ge),pe()}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],5:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../core/request"),a=e("../core/promise"),s=e("../core/settings"),u=e("../core/core"),c=e("../core/logger"),l=e("./storage"),f=e("../core/user"),d=new s.Settings,h=null,p="DEFER_REGISTER",g={},v={},y=[],_=function(){function e(t){r(this,e),this._dispatcher=null,this._dispatchIntervalTime=30,this._useEventCaching=!0,this._serviceHost=d.getURL("analytics"),this.logger=new c.Logger({prefix:"Ionic Analytics:"}),this.logger._silence=!0,this.storage=u.IonicPlatform.getStorage(),this.cache=new l.BucketStorage("ionic_analytics"),this._addGlobalPropertyDefaults(),t!==p&&this.register(t)}return i(e,[{key:"_addGlobalPropertyDefaults",value:function(){var e=this;e.setGlobalProperties(function(e,t){t._user=JSON.parse(JSON.stringify(f.User.current())),t._app={app_id:d.get("app_id"),analytics_version:u.IonicPlatform.Version}})}},{key:"_enqueueEvent",value:function(e,t){var n=this;if(g.dryRun)return n.logger.info("event recieved but not sent (dryRun active):"),n.logger.info(e),void n.logger.info(t);n.logger.info("enqueuing event to send later:"),n.logger.info(e),n.logger.info(t),t.keen||(t.keen={}),t.keen.timestamp=(new Date).toISOString();var r=n.cache.get("event_queue")||{};r[e]||(r[e]=[]),r[e].push(t),n.cache.set("event_queue",r)}},{key:"_requestAnalyticsKey",value:function(){var e={method:"GET",json:!0,uri:d.getURL("api")+"/api/v1/app/"+d.get("app_id")+"/keys/write",headers:{Authorization:"basic "+btoa(d.get("app_id")+":"+d.get("api_key"))}};return new o.APIRequest(e)}},{key:"_postEvent",value:function(e,t){var n=this,r={name:[t]};h||n.logger.error("Cannot send events to the analytics server without an Analytics key.");var i={method:"POST",url:n._serviceHost+"/api/v1/events/"+d.get("app_id"),body:r,json:!0,headers:{Authorization:h}};return new o.APIRequest(i)}},{key:"_postEvents",value:function(e){var t=this;h||t.logger.info("Cannot send events to the analytics server without an Analytics key.");var n={method:"POST",url:t._serviceHost+"/api/v1/events/"+d.get("app_id"),body:e,json:!0,headers:{Authorization:h}};return new o.APIRequest(n)}},{key:"_dispatchQueue",value:function(){var e=this,t=this.cache.get("event_queue")||{};0!==Object.keys(t).length&&u.IonicPlatform.deviceConnectedToNetwork()&&e.storage.lockedAsyncCall(e.cache.scopedKey("event_dispatch"),function(){return e._postEvents(t)}).then(function(){e.cache.set("event_queue",{}),e.logger.info("sent events"),e.logger.info(t)},function(n){e._handleDispatchError(n,this,t)})}},{key:"_getRequestStatusCode",value:function(e){var t=!1;return e&&e.requestInfo._lastResponse&&e.requestInfo._lastResponse.statusCode&&(t=e.requestInfo._lastResponse.statusCode),t}},{key:"_handleDispatchError",value:function(e,t,n){var r=this,i=this._getRequestStatusCode(t);"last_call_interrupted"===e?r.cache.set("event_queue",{}):i?(r.cache.set("event_queue",{}),r.logger.error("Error sending analytics data: Server responded with error"),r.logger.error(n)):r.logger.error("Error sending analytics data: Failed to connect to analytics server.")}},{key:"_handleRegisterError",value:function(e,t){var n=this._getRequestStatusCode(t),r=" See http://docs.ionic.io/v1.0/docs/io-quick-start";switch(n){case 401:self.logger.error("The api key and app id you provided did not register on the server. "+r);break;case 404:self.logger.error('The app id you provided ("'+d.get("app_id")+'") was not found.'+r);break;default:self.logger.log("Unable to request analytics key."),self.logger.log(e)}}},{key:"register",value:function(e){var t=this,n=new a.DeferredPromise;return this.hasValidSettings?(g=e||{},g.silent?this.logger._silence=!0:this.logger._silence=!1,g.dryRun&&this.logger.log("dryRun mode is active. Analytics will not send any events."),this._requestAnalyticsKey().then(function(e){h=e.payload.write_key,t.logger.info("successfully registered analytics key"),t.dispatchInterval=t.dispatchInterval,n.resolve(!0)},function(e){t._handleRegisterError(e,this),n.reject(!1)}),n.promise):(n.reject(!1),n.promise)}},{key:"setGlobalProperties",value:function(e){var t=this,n=typeof e;switch(n){case"object":for(var r in e)e.hasOwnProperty(r)&&(v[r]=e[r]);break;case"function":y.push(e);break;default:t.logger.error("setGlobalProperties parameter must be an object or function.")}}},{key:"track",value:function(e,t){var n=this;if(!this.hasValidSettings)return!1;t||(t={});for(var r in v)v.hasOwnProperty(r)&&void 0===t[r]&&(t[r]=v[r]);for(var i=0;i<y.length;i++){var o=y[i];o.call(null,e,t)}this._useEventCaching?n._enqueueEvent(e,t):g.dryRun?(n.logger.info("dryRun active, will not send event"),n.logger.info(e),n.logger.info(t)):n._postEvent(e,t)}},{key:"unsetGlobalProperty",value:function(e){var t=this,n=typeof e;switch(n){case"string":delete v[e];break;case"function":var r=y.indexOf(e);-1===r&&t.logger.error("The function passed to unsetGlobalProperty was not a global property."),y.splice(r,1);break;default:t.logger.error("unsetGlobalProperty parameter must be a string or function.")}}},{key:"hasValidSettings",get:function(){if(!d.get("app_id")||!d.get("api_key")){var e="A valid app_id and api_key are required before you can utilize analytics properly. See http://docs.ionic.io/v1.0/docs/io-quick-start";return this.logger.info(e),!1}return!0}},{key:"dispatchInterval",set:function(e){var t=this;this._dispatchIntervalTime=e,this._dispatcher&&window.clearInterval(this.dispatcher),e>0?(this._dispatcher=window.setInterval(function(){t._dispatchQueue()},1e3*e),this._useEventCaching=!0):this._useEventCaching=!1},get:function(){return this._dispatchIntervalTime}}]),e}();n.Analytics=_},{"../core/core":12,"../core/logger":15,"../core/promise":16,"../core/request":17,"../core/settings":18,"../core/user":20,"./storage":9}],6:[function(e,t,n){"use strict";if("object"==typeof angular&&angular.module){var r=function(e){return["$ionicAnalytics","$ionicGesture",function(t,n){for(var r=["drag","dragstart","dragend","dragleft","dragright","dragup","dragdown","swipe","swipeleft","swiperight","swipeup","swipedown","tap","doubletap","hold","transform","pinch","pinchin","pinchout","rotate"],i=!1,o=0;o<r.length;o++)r[o]===e.toLowerCase()&&(i=!0);return{restrict:"A",link:function(r,o,a){function s(e){var n=r.$eval(a.ionTrackData)||{};c?t.track(c,n):t.trackClick(e.pageX,e.pageY,e.target,{data:n})}var u=e[0].toUpperCase()+e.slice(1),c=a["ionTrack"+u];if(i){var l=n.on(e,s,o);r.$on("$destroy",function(){n.off(l,e,s)})}else o.on(e,s),r.$on("$destroy",function(){o.off(e,s)})}}}]},i=null;angular.module("ionic.service.analytics",["ionic"]).value("IONIC_ANALYTICS_VERSION",Ionic.Analytics.version).factory("$ionicAnalytics",[function(){return i||(i=new Ionic.Analytics("DEFER_REGISTER")),i}]).factory("domSerializer",[function(){return new Ionic.AnalyticSerializers.DOMSerializer}]).run(["$ionicAnalytics","$state",function(e,t){e.setGlobalProperties(function(e,n){n._ui||(n._ui={}),n._ui.active_state=t.current.name})}]),angular.module("ionic.service.analytics").provider("$ionicAutoTrack",[function(){var e={},t=!1;this.disableTracking=function(n){n?e[n]=!0:t=!0},this.$get=[function(){return{isEnabled:function(n){return!t&&!e[n]}}}]}]).run(["$ionicAutoTrack","$ionicAnalytics",function(e,t){e.isEnabled("Load")&&t.track("Load")}]).run(["$ionicAutoTrack","$document","$ionicAnalytics","domSerializer",function(e,t,n,r){e.isEnabled("Tap")&&t.on("click",function(e){var t=e.target.getBoundingClientRect(),i=t.right-t.left,o=t.bottom-t.top,a=(e.pageX-t.left)/i,s=(e.pageY-t.top)/o,u={coordinates:{x:e.pageX,y:e.pageY},target:r.elementSelector(e.target),target_identifier:r.elementName(e.target)};isFinite(a)&&isFinite(s)&&(u.coordinates.x_norm=a,u.coordinates.y_norm=s),n.track("Tap",{_ui:u})})}]).run(["$ionicAutoTrack","$ionicAnalytics","$rootScope",function(e,t,n){e.isEnabled("State Change")&&n.$on("$stateChangeSuccess",function(e,n,r,i,o){t.track("State Change",{from:i.name,to:n.name})})}]).directive("ionTrackClick",r("click")).directive("ionTrackTap",r("tap")).directive("ionTrackDoubletap",r("doubletap")).directive("ionTrackHold",r("hold")).directive("ionTrackRelease",r("release")).directive("ionTrackDrag",r("drag")).directive("ionTrackDragLeft",r("dragleft")).directive("ionTrackDragRight",r("dragright")).directive("ionTrackDragUp",r("dragup")).directive("ionTrackDragDown",r("dragdown")).directive("ionTrackSwipeLeft",r("swipeleft")).directive("ionTrackSwipeRight",r("swiperight")).directive("ionTrackSwipeUp",r("swipeup")).directive("ionTrackSwipeDown",r("swipedown")).directive("ionTrackTransform",r("hold")).directive("ionTrackPinch",r("pinch")).directive("ionTrackPinchIn",r("pinchin")).directive("ionTrackPinchOut",r("pinchout")).directive("ionTrackRotate",r("rotate"))}},{}],7:[function(e,t,n){"use strict";var r=e("./analytics"),i=e("./storage"),o=e("./serializers");window.Ionic=window.Ionic||{},Ionic.Analytics=r.Analytics,Ionic.AnalyticStorage={},Ionic.AnalyticStorage.BucketStorage=i.BucketStorage,Ionic.AnalyticSerializers={},Ionic.AnalyticSerializers.DOMSerializer=o.DOMSerializer},{"./analytics":5,"./serializers":8,"./storage":9}],8:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e)}return i(e,[{key:"elementSelector",value:function(e){for(var t=[];"HTML"!==e.tagName;){var n=e.tagName.toLowerCase(),r=e.getAttribute("id");r&&(n+="#"+r);var i=e.className;if(i)for(var o=i.split(" "),a=0;a<o.length;a++){var s=o[a];s&&(n+="."+s)}if(!e.parentNode)return null;var u=Array.prototype.indexOf.call(e.parentNode.children,e);n+=":nth-child("+(u+1)+")",e=e.parentNode,t.push(n)}return t.reverse().join(">")}},{key:"elementName",value:function(e){var t=e.getAttribute("ion-track-name");if(t)return t;var n=e.getAttribute("id");return n?n:null}}]),e}();n.DOMSerializer=o},{}],9:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../core/settings"),a=new o.Settings,s=function(){function e(t){r(this,e),this.name=t,this.baseStorage=Ionic.IO.Core.getStorage()}return i(e,[{key:"get",value:function(e){return this.baseStorage.retrieveObject(this.scopedKey(e))}},{key:"set",value:function(e,t){return this.baseStorage.storeObject(this.scopedKey(e),t)}},{key:"scopedKey",value:function(e){return this.name+"_"+e+"_"+a.get("app_id")}}]),e}();n.BucketStorage=s},{"../core/settings":18}],10:[function(e,t,n){"use strict";"object"==typeof angular&&angular.module&&angular.module("ionic.service.core",[]).provider("persistentStorage",function(){return{$get:[function(){var e=Ionic.getService("Storage");return e||(e=new Ionic.IO.Storage,Ionic.addService("Storage",e,!0)),e}]}}).factory("$ionicCoreSettings",[function(){return new Ionic.IO.Settings}]).factory("$ionicUser",[function(){return Ionic.User}]).run([function(){Ionic.io()}])},{}],11:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./logger"),a=function(){function e(t,n){if(r(this,e),this.logger=new o.Logger({prefix:"Ionic App:"}),!t||""===t)return this.logger.info("No app_id was provided"),!1;if(!n||""===n)return this.logger.info("No api_key was provided"),!1;var i={id:t,apiKey:n};this.privateVar=function(e){return i[e]||null},this.devPush=null,this.gcmKey=null}return i(e,[{key:"toString",value:function(){return"<IonicApp ['"+this.id+"'>"}},{key:"id",get:function(){return this.privateVar("id")}},{key:"apiKey",get:function(){return this.privateVar("apiKey")}}]),e}();n.App=a},{"./logger":15}],12:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./events"),a=e("./storage"),s=e("./logger"),u=function(){function e(){r(this,e);var t=this;this.logger=new s.Logger({prefix:"Ionic Core:"}),this.logger.info("init"),this._pluginsReady=!1,this.emitter=e.getEmitter();try{document.addEventListener("deviceready",function(){t.logger.info("plugins are ready"),t._pluginsReady=!0,t.emitter.emit("ionic_core:plugins_ready")},!1)}catch(n){t.logger.info("unable to listen for cordova plugins to be ready")}this._bootstrap()}return i(e,[{key:"_isCordovaAvailable",value:function(){var e=this;if(this.logger.info("searching for cordova.js"),"undefined"!=typeof cordova)return this.logger.info("cordova.js has already been loaded"),!0;for(var t=document.getElementsByTagName("script"),n=t.length,r=0;n>r;r++){var i=t[r].getAttribute("src");if(i){var o=i.split("/"),a=0;try{if(a=o.length,"cordova.js"===o[a-1])return e.logger.info("cordova.js has previously been included."),!0}catch(s){e.logger.info("encountered error while testing for cordova.js presence, "+s.toString())}}}return!1}},{key:"loadCordova",value:function(){var t=this;if(!this._isCordovaAvailable()){var n=document.createElement("script"),r="cordova.js";switch(e.getDeviceTypeByNavigator()){case"android":"file"===window.location.href.substring(0,4)&&(r="file:///android_asset/www/cordova.js");break;case"ipad":case"iphone":try{var i=window.location.search.match(/cordova_js_bootstrap_resource=(.*?)(&|#|$)/i);i&&(r=decodeURI(i[1]))}catch(o){t.logger.info("could not find cordova_js_bootstrap_resource query param"),
t.logger.info(o)}break;case"unknown":return!1}n.setAttribute("src",r),document.head.appendChild(n),t.logger.info("injecting cordova.js")}}},{key:"_bootstrap",value:function(){this.loadCordova()}},{key:"onReady",value:function(e){var t=this;this._pluginsReady?e(t):t.emitter.on("ionic_core:plugins_ready",function(){e(t)})}}],[{key:"getEmitter",value:function(){return o.EventEmitter}},{key:"getStorage",value:function(){return a.Storage}},{key:"getDeviceTypeByNavigator",value:function(){var e=navigator.userAgent,t=e.match(/iPad/i);if(t&&"ipad"===t[0].toLowerCase())return"ipad";var n=e.match(/iPhone/i);if(n&&"iphone"===n[0].toLowerCase())return"iphone";var r=e.match(/Android/i);return r&&"android"===r[0].toLowerCase()?"android":"unknown"}},{key:"isAndroidDevice",value:function(){var t=e.getDeviceTypeByNavigator();return"android"===t?!0:!1}},{key:"isIOSDevice",value:function(){var t=e.getDeviceTypeByNavigator();return"iphone"===t||"ipad"===t?!0:!1}},{key:"deviceConnectedToNetwork",value:function(e){if("undefined"==typeof e&&(e=!1),"undefined"==typeof navigator.connection||"undefined"==typeof navigator.connection.type||"undefined"==typeof Connection)return e?!1:!0;switch(navigator.connection.type){case Connection.ETHERNET:case Connection.WIFI:case Connection.CELL_2G:case Connection.CELL_3G:case Connection.CELL_4G:case Connection.CELL:return!0;default:return!1}}},{key:"Version",get:function(){return"0.2.0"}}]),e}();n.IonicPlatform=u},{"./events":14,"./logger":15,"./storage":19}],13:[function(e,t,n){"use strict";var r=e("./app"),i=e("./core"),o=e("./events"),a=e("./logger"),s=e("./promise"),u=e("./request"),c=e("./settings"),l=e("./storage"),f=e("./user");window.Ionic=window.Ionic||{},Ionic.Core=i.IonicPlatform,Ionic.User=f.User,Ionic.IO={},Ionic.IO.App=r.App,Ionic.IO.EventEmitter=o.EventEmitter,Ionic.IO.Logger=a.Logger,Ionic.IO.Promise=s.Promise,Ionic.IO.DeferredPromise=s.DeferredPromise,Ionic.IO.Request=u.Request,Ionic.IO.Response=u.Response,Ionic.IO.APIRequest=u.APIRequest,Ionic.IO.APIResponse=u.APIResponse,Ionic.IO.Storage=l.Storage,Ionic.IO.Settings=c.Settings;var d={};Ionic.io=function(){return"undefined"==typeof Ionic.IO.main&&(Ionic.IO.main=new Ionic.IO.Core),Ionic.IO.main},Ionic.getService=function(e){return"undefined"!=typeof d[e]&&d[e]?d[e]:!1},Ionic.addService=function(e,t,n){t&&"undefined"==typeof d[e]?d[e]=t:t&&n&&(d[e]=t)},Ionic.removeService=function(e){"undefined"!=typeof d[e]&&delete d[e]}},{"./app":11,"./core":12,"./events":14,"./logger":15,"./promise":16,"./request":17,"./settings":18,"./storage":19,"./user":20}],14:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("events"),a=function(){function e(){r(this,e),this._emitter=new o}return i(e,[{key:"on",value:function(e,t){return this._emitter.on(e,t)}},{key:"emit",value:function(e,t){return this._emitter.emit(e,t)}}]),e}();n.EventEmitter=a},{events:2}],15:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){r(this,e);var n=t||{};this._silence=!1,this._prefix=!1,this._options=n,this._bootstrap()}return i(e,[{key:"_bootstrap",value:function(){this._options.prefix&&(this._prefix=this._options.prefix)}},{key:"info",value:function(e){this._silence||(this._prefix?console.log(this._prefix,e):console.log(e))}},{key:"error",value:function(e){this._prefix?console.error(this._prefix,e):console.error(e)}}]),e}();n.Logger=o},{}],16:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("es6-promise").Promise,a=o;n.Promise=a;var s=function(){function e(){r(this,e);var t=this;this._update=!1,this.promise=new o(function(e,n){t.resolve=e,t.reject=n});var n=this.promise.then;this.promise.then=function(e,r,i){return t._update=i,n.call(t.promise,e,r)}}return i(e,[{key:"notify",value:function(e){this._update&&"function"==typeof this._update&&this._update(e)}}]),e}();n.DeferredPromise=s},{"es6-promise":4}],17:[function(e,t,n){"use strict";function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(e,t,n){for(var r=!0;r;){var i=e,o=t,a=n;s=c=u=void 0,r=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(a)}var c=Object.getPrototypeOf(i);if(null===c)return void 0;e=c,t=o,n=a,r=!0}},a=e("./promise"),s=e("browser-request"),u=function d(){i(this,d)};n.Request=u;var c=function h(){i(this,h)};n.Response=c;var l=function(e){function t(){i(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this)}return r(t,e),t}(c);n.APIResponse=l;var f=function(e){function t(e){i(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var n={},r=new a.Promise(function(t,r){s(e,function(e,i,o){if(n._lastError=e,n._lastResponse=i,n._lastResult=o,e)r(e);else if(i.statusCode<200||i.statusCode>=400){var a=new Error("Request Failed with status code of "+i.statusCode);r(a)}else t({response:i,payload:o})})});return r.requestInfo=n,r}return r(t,e),t}(u);n.APIRequest=f},{"./promise":16,"browser-request":1}],18:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){return r(this,e),this._settings=null,this}return i(e,[{key:"factory",value:function(e,t){return this._settings=t(),this}},{key:"get",value:function(e){return this._settings.get(e)}},{key:"finish",value:function(){return this}}]),e}(),a=(new o).factory("$ionicCoreSettings",function(){var e={};return{get:function(t){return e[t]?e[t]:null}}}).finish(),s=function(){function e(){r(this,e),this._locations={api:"https://apps.ionic.io",push:"https://push.ionic.io",analytics:"https://analytics.ionic.io"},this._devLocations=this.get("dev_locations"),this._devLocations||(this._devLocations={})}return i(e,[{key:"get",value:function(e){return a.get(e)}},{key:"getURL",value:function(e){return this._devLocations[e]?this._devLocations[e]:this._locations[e]?this._locations[e]:null}}]),e}();n.Settings=s},{}],19:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./promise"),a=function(){function e(){r(this,e)}return i(e,[{key:"get",value:function(e){return window.localStorage.getItem(e)}},{key:"remove",value:function(e){return window.localStorage.removeItem(e)}},{key:"set",value:function(e,t){return window.localStorage.setItem(e,t)}}]),e}(),s={},u={},c=function(){function e(){r(this,e),this.strategy=new a}return i(e,[{key:"storeObject",value:function(e,t){var n=JSON.stringify(t);this.strategy.set(e,n),s[e]=t}},{key:"retrieveObject",value:function(e){var t=s[e];if(t)return t;var n=this.strategy.get(e);if(null==n)return null;try{return JSON.parse(n)}catch(r){return null}}},{key:"lockedAsyncCall",value:function(e,t){var n=this,r=new o.DeferredPromise;return u[e]?(r.reject("in_progress"),r.promise):"locked"===this.strategy.get(e)?(r.reject("last_call_interrupted"),r.promise.then(null,function(){n.strategy.remove(e)}),r.promise):(u[e]=!0,n.strategy.set(e,"locked"),t().then(function(t){r.resolve(t),delete u[e],n.strategy.remove(e)},function(t){r.reject(t),delete u[e],n.strategy.remove(e)},function(e){r.notify(e)}),r.promise)}}]),e}();n.Storage=c},{"./promise":16}],20:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./request"),a=e("./promise"),s=e("./settings"),u=e("./core"),c=e("./storage"),l=e("./logger"),f=e("../push/push-token"),d=u.IonicPlatform,h=null,p=new s.Settings,g=new c.Storage,v=p.getURL("api")+"/api/v1/app/"+p.get("app_id")+"/users",y={load:function(e){return v+"/"+e.id},remove:function(e){return v+"/"+e.id},save:function(){return v+"/identify"},addToken:function(){return v+"/pushUnique"}},_=function(){function e(){r(this,e)}return i(e,null,[{key:"store",value:function(){g.storeObject(e.label,b.current())}},{key:"getRawData",value:function(){return g.retrieveObject(e.label)||!1}},{key:"load",value:function(){var t=g.retrieveObject(e.label)||!1;return t?b.fromContext(t):!1}},{key:"label",get:function(){return"ionic_io_user_"+p.get("app_id")}}]),e}(),m=function(){function e(t){r(this,e),this.logger=new l.Logger({prefix:"Ionic Push Token:"}),this.tokens={android:[],ios:[]},t&&"object"==typeof t&&(this.tokens=t)}return i(e,[{key:"addToken",value:function(e){var t=null;if("undefined"==typeof e||!e||""===e)return this.logger.info("you need to pass a valid token to addToken()"),!1;if(e.token&&(e=e.token),d.isAndroidDevice()?t="android":d.isIOSDevice()&&(t="ios"),null===t||!this.tokens.hasOwnProperty(t))return this.logger.info("cannot determine the token platform. Are you running on an Android or iOS device?"),!1;var n=this.tokens[t],r=!1,i=null;for(i in n)n[i]===e&&(r=!0);return r||n.push(e),!0}},{key:"removeToken",value:function(e){var t;for(t in this.tokens){var n,r=this.tokens[t];for(n in r)r[n]===e&&r.splice(n,1)}return!0}}]),e}(),k=function(){function e(t){r(this,e),this.data={},"object"==typeof t&&(this.data=t)}return i(e,[{key:"set",value:function(e,t){this.data[e]=t}},{key:"unset",value:function(e){delete this.data[e]}},{key:"get",value:function(e,t){return this.data.hasOwnProperty(e)?this.data[e]:t||null}},{key:"toString",value:function(){return JSON.stringify(this.data)}}]),e}(),b=function(){function e(){r(this,e),this.logger=new l.Logger({prefix:"Ionic User:"}),this._blockLoad=!1,this._blockSave=!1,this._blockDelete=!1,this._dirty=!1,this._fresh=!0,this.push=new m,this.data=new k}return i(e,[{key:"isDirty",value:function(){return this._dirty}},{key:"isFresh",value:function(){return this._fresh}},{key:"getAPIFormat",value:function(){var e=this.data.data;return e.user_id=this.id,e._push={android_tokens:this.push.tokens.android,ios_tokens:this.push.tokens.ios},e}},{key:"getFormat",value:function(e){var t=this,n=null;switch(e){case"api":n=t.getAPIFormat()}return n}},{key:"delete",value:function(){var e=this,t=new a.DeferredPromise;return e.valid?(e._blockDelete?(e.logger.info("a delete operation is already in progress for "+this+"."),t.reject(!1)):(e._blockDelete=!0,new o.APIRequest({uri:y.remove(this),method:"DELETE",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(n){e._blockDelete=!1,e.logger.info("deleted "+e),t.resolve(n)},function(n){e._blockDelete=!1,e.logger.error(n),t.reject(n)})),t.promise):!1}},{key:"_store",value:function(){this===e.current()&&_.store()}},{key:"save",value:function(){var e=this,t=new a.DeferredPromise;return e._blockSave?(e.logger.info("a save operation is already in progress for "+this+"."),t.reject(!1)):(e._blockSave=!0,new o.APIRequest({uri:y.save(this),method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e.getFormat("api"))}).then(function(n){e._dirty=!1,e._fresh=!1,e.logger.info("saved user"),t.resolve(n)},function(n){e._dirty=!0,e.logger.error(n),t.reject(n)}).then(function(){e._blockSave=!1,e._store()})),t.promise}},{key:"toString",value:function(){return"<IonicUser ['"+this.id+"']>"}},{key:"addPushToken",value:function(e){return this.push.addToken(e)}},{key:"removePushToken",value:function(e){return e instanceof f.PushToken||(e=new f.PushToken(e)),this.push.removeToken(e)}},{key:"set",value:function(e,t){return this.data.set(e,t)}},{key:"get",value:function(e,t){return this.data.get(e,t)}},{key:"remove",value:function(e){return this.data.unset(e)}},{key:"valid",get:function(){return this.id?!0:!1}},{key:"id",set:function(e){return e&&"string"==typeof e&&""!==e?(this._id=e,!0):!1},get:function(){return this._id||null}}],[{key:"current",value:function(t){return t?(h=t,_.store(),h):(h||(h=_.load()),h||(h=new e),h)}},{key:"fromContext",value:function(t){var n=new e;return n.id=t._id,n.data=new k(t.data),n.push=new m(t.push.tokens),n._fresh=t._fresh,n._dirty=t._dirty,n}},{key:"load",value:function(t){var n=new a.DeferredPromise,r=new e;return r.id=t,r._blockLoad?(r.logger.info("a load operation is already in progress for "+this+"."),n.reject(!1)):(r._blockLoad=!0,new o.APIRequest({uri:y.load(r),method:"GET",json:!0,headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){r._blockLoad=!1,r.logger.info("loaded user"),r.data=new k(e.payload.custom_data),e.payload._push&&e.payload._push.android_tokens&&(r.push.tokens.android=e.payload._push.android_tokens),e.payload._push&&e.payload._push.ios_tokens&&(r.push.tokens.ios=e.payload._push.ios_tokens),r.image=e.payload.image,r._fresh=!1,n.resolve(r)},function(e){r._blockLoad=!1,r.logger.error(e),n.reject(e)})),n.promise}},{key:"anonymousId",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}}]),e}();n.User=b},{"../push/push-token":27,"./core":12,"./logger":15,"./promise":16,"./request":17,"./settings":18,"./storage":19}],21:[function(e,t,n){"use strict";if("object"==typeof angular&&angular.module){var r=null;angular.module("ionic.service.deploy",[]).factory("$ionicDeploy",[function(){return r||(r=new Ionic.Deploy),r}])}},{}],22:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../core/settings"),a=e("../core/promise"),s=e("../core/logger"),u=e("../core/core"),c=new o.Settings,l="IONIC_DEPLOY_MISSING_PLUGIN",f=5e3,d=6e4,h=function(){function e(){r(this,e);var t=this;this.logger=new s.Logger({prefix:"Ionic Deploy:"}),this._plugin=!1,this._isReady=!1,this._channelTag="production",this._emitter=u.IonicPlatform.getEmitter(),this.logger.info("init"),this._emitter.on("ionic_core:ready",function(){t._isReady=!0,t._emitter.emit("ionic_deploy:ready")})}return i(e,[{key:"_getPlugin",value:function(){return this._plugin?this._plugin:"undefined"==typeof IonicDeploy?(this.logger.info("plugin is not installed or has not loaded. Have you run `ionic plugin add ionic-plugin-deploy` yet?"),!1):(this._plugin=IonicDeploy,IonicDeploy)}},{key:"initialize",value:function(){this._getPlugin()&&this._plugin.initialize(c.get("app_id"))}},{key:"check",value:function(){var e=this,t=new a.DeferredPromise;return this._getPlugin()?this._plugin.check(c.get("app_id"),this._channelTag,function(n){n&&"true"===n?(e.logger.info("an update is available"),t.resolve(!0)):(e.logger.info("no updates available"),t.resolve(!1))},function(n){e.logger.error("encountered an error while checking for updates"),t.reject(n)}):t.reject(l),t.promise}},{key:"download",value:function(){var e=this,t=new a.DeferredPromise;return this._getPlugin()?this._plugin.download(c.get("app_id"),function(n){"true"!==n&&"false"!==n?t.notify(n):("true"===n&&e.logger.info("download complete"),t.resolve("true"===n))},function(e){t.reject(e)}):t.reject(l),t.promise}},{key:"extract",value:function(){var e=this,t=new a.DeferredPromise;return this._getPlugin()?this._plugin.extract(c.get("app_id"),function(n){"done"!==n?t.notify(n):("true"===n&&e.logger.info("extraction complete"),t.resolve(n))},function(e){t.reject(e)}):t.reject(l),t.promise}},{key:"load",value:function(){this._getPlugin()&&this._plugin.redirect(c.get("app_id"))}},{key:"watch",value:function(e){function t(){i.check().then(function(e){e&&n.notify(e)},function(e){i.logger.info("unable to check for updates, ",e)}),this._checkTimeout&&(this._checkTimeout=setTimeout(t.bind(i),r.interval))}var n=new a.DeferredPromise,r=e||{},i=this;return"undefined"==typeof r.initialDelay&&(r.initialDelay=f),"undefined"==typeof r.interval&&(r.interval=d),this._checkTimeout=setTimeout(t.bind(i),r.initialDelay),n.promise}},{key:"unwatch",value:function(){clearTimeout(this._checkTimeout),this._checkTimeout=null}},{key:"info",value:function(){var e=new a.DeferredPromise;return this._getPlugin()?this._plugin.info(c.get("app_id"),function(t){e.resolve(t)},function(t){e.reject(t)}):e.reject(l),e.promise}},{key:"setChannel",value:function(e){this._channelTag=e}},{key:"update",value:function(){var e=new a.DeferredPromise,t=this;return this._getPlugin()?t.check().then(function(n){if(n===!0){var r=0;t.download().then(function(n){n||e.reject("download error"),t.extract().then(function(n){n||e.reject("extraction error"),t._plugin.redirect(c.get("app_id"))},function(t){e.reject(t)},function(t){var n=r+t/2;e.notify(n)})},function(t){e.reject(t)},function(t){r=t/2,e.notify(r)})}else e.resolve(!1)},function(t){e.reject(t)}):e.reject(l),e.promise}},{key:"onReady",value:function(e){var t=this;this._isReady?e(t):t._emitter.on("ionic_deploy:ready",function(){e(t)})}}]),e}();n.Deploy=h},{"../core/core":12,"../core/logger":15,"../core/promise":16,"../core/settings":18}],23:[function(e,t,n){"use strict";var r=e("./deploy");window.Ionic=window.Ionic||{},Ionic.Deploy=r.Deploy},{"./deploy":22}],24:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();if("object"==typeof angular&&angular.module){var o=null;angular.module("ionic.service.push",[]).factory("$ionicPushAction",["$state",function(e){var t=function(){function t(){r(this,t)}return i(t,[{key:"notificationNavigation",value:function(t){var n=!1,r={};try{n=t.additionalData.payload.$state}catch(i){n=!1}try{r=JSON.parse(t.additionalData.payload.$stateParams)}catch(i){r={}}n&&e.go(n,r)}}]),t}();return new t}]).factory("$ionicPush",[function(){return o||(o=new Ionic.Push("DEFER_INIT")),o}]).run(function(e){Ionic.IO.Core.getEmitter().on("ionic_push:processNotification",function(t){t.additionalData.foreground===!1&&e.notificationNavigation(t)})})}},{}],25:[function(e,t,n){"use strict";var r=e("./push"),i=e("./push-token");window.Ionic=window.Ionic||{},Ionic.Push=r.Push,Ionic.PushToken=i.PushToken},{"./push":28,"./push-token":27}],26:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../core/request"),a=e("../core/settings"),s=e("../core/core"),u=e("../core/logger"),c=new a.Settings,l=function(){function e(){r(this,e),this.logger=new u.Logger({prefix:"Ionic Push (dev):"}),this._serviceHost=c.getURL("push"),this._token=!1,this._watch=!1,this._emitter=s.IonicPlatform.getEmitter()}return i(e,[{key:"getDevToken",value:function(){var e="DEV-xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)});return this._token=e,this._token}},{key:"init",value:function(e){this._push=e;var t=this._token,n=this;t||(t=this.getDevToken());var r={method:"POST",uri:this._serviceHost+"/dev/push",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({dev_token:t})};new o.APIRequest(r).then(function(){n.logger.info("registered with development push service",t),n._emitter.emit("ionic_push:token",{token:t}),n.registerCallback&&n.registerCallback({registrationId:t}),n.watch()},function(e){n.logger.error("error connecting development push service.",e)})}},{key:"checkForNotifications",value:function(){if(!this._token)return!1;var e=this,t={method:"GET",uri:this._serviceHost+"/dev/push/check",headers:{Accept:"application/json","Content-Type":"application/json","X-Ionic-Dev-Token":this._token},json:!0};new o.APIRequest(t).then(function(t){if(t.payload.messages.length>0){var n={message:t.payload.messages[0],title:"DEVELOPMENT PUSH"};console.warn("Ionic Push: Development Push received. Development pushes will not contain payload data.");var r=e._push.notificationCallback&&e._push.notificationCallback(n);if(r===!1)return;alert(n.message)}},function(t){e.logger.error("unable to check for development pushes.",t)})}},{key:"watch",value:function(){this.logger.info("watching for new notifications");var e=this;this._watch||(this._watch=setInterval(function(){e.checkForNotifications()},5e3))}},{key:"halt",value:function(){this._watch&&clearInterval(this._watch)}}]),e}();n.PushDevService=l},{"../core/core":12,"../core/logger":15,"../core/request":17,"../core/settings":18}],27:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){r(this,e),this._token=t||null}return i(e,[{key:"toString",value:function(){var e=this._token||"null";return"<PushToken ['"+e+"']>"}},{key:"token",set:function(e){this._token=e},get:function(){return this._token}}]),e}();n.PushToken=o},{}],28:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../core/app"),a=e("../core/settings"),s=e("../core/core"),u=e("../core/logger"),c=e("./push-token"),l=e("./push-dev"),f=new a.Settings,d="DEFER_INIT",h=function(){function e(t){r(this,e),this.logger=new u.Logger({prefix:"Ionic Push:"});var n=new o.App(f.get("app_id"),f.get("api_key"));return n.devPush=f.get("dev_push"),n.gcmKey=f.get("gcm_key"),n.id&&n.apiKey?!s.IonicPlatform.isAndroidDevice()||n.devPush||n.gcmKey?(this.app=o.App,this.registerCallback=!1,this.notificationCallback=!1,this.errorCallback=!1,this._token=!1,this._notification=!1,this._debug=!1,this._isReady=!1,this._tokenReady=!1,this._blockRegistration=!1,this._emitter=s.IonicPlatform.getEmitter(),void(t!==d&&this.init(t))):(this.logger.error("GCM project number not found (http://docs.ionic.io/docs/push-android-setup)"),!1):(this.logger.error("no app_id or api_key found. (http://docs.ionic.io/docs/io-install)"),!1)}return i(e,[{key:"init",value:function(e){var t=this._getPushPlugin();if(!t)return!1;if("undefined"==typeof e&&(e={}),"object"!=typeof e)return this.logger.error("init() requires a valid config object."),!1;var n=this;return e.pluginConfig||(e.pluginConfig={}),s.IonicPlatform.isAndroidDevice()&&(e.pluginConfig.android||(e.pluginConfig.android={}),e.pluginConfig.android.senderId||(e.pluginConfig.android.senderID=n.app.gcmKey)),e.onRegister&&this.setRegisterCallback(e.onRegister),e.onNotification&&this.setNotificationCallback(e.onNotification),e.onError&&this.setErrorCallback(e.onError),this._config=JSON.parse(JSON.stringify(e)),this._isReady=!0,this._emitter.emit("ionic_push:ready",{config:this._config}),this}},{key:"addTokenToUser",value:function(e){this._token||this.logger.info("a token must be registered before you can add it to a user."),"object"==typeof e?s.IonicPlatform.isAndroidDevice()?e.addPushToken(this._token,"android"):s.IonicPlatform.isIOSDevice()?e.addPushToken(this._token,"ios"):this.logger.info("token is not a valid Android or iOS registration id. Cannot save to user."):this.logger.info("invalid $ionicUser object passed to $ionicPush.addToUser()")}},{key:"register",value:function(e){this.logger.info("register");var t=this;return this._blockRegistration?(t.logger.info("another registration is already in progress."),!1):(this._blockRegistration=!0,void this.onReady(function(){if(t.app.devPush){var n=new l.PushDevService;n.init(t),t._blockRegistration=!1,t._tokenReady=!0}else t._plugin=PushNotification.init(t._config.pluginConfig),t._plugin.on("registration",function(n){t._blockRegistration=!1,t._token=new c.Token(n.registrationId),t._tokenReady=!0,"function"==typeof e&&e(t._token)}),t._debugCallbackRegistration(),t._callbackRegistration()}))}},{key:"unregister",value:function(e,t){return this._plugin?this._plugin.unregister(e,t):!1}},{key:"getPayload",value:function(e){var t={};return"object"==typeof e&&e.additionalData&&e.additionalData.payload&&(t=e.additionalData.payload),t}},{key:"setRegisterCallback",value:function(e){return"function"!=typeof e?(this.logger.info("setRegisterCallback() requires a valid callback function"),!1):(this.registerCallback=e,!0)}},{key:"setNotificationCallback",value:function(e){return"function"!=typeof e?(this.logger.info("setNotificationCallback() requires a valid callback function"),!1):(this.notificationCallback=e,!0)}},{key:"setErrorCallback",value:function(e){return"function"!=typeof e?(this.logger.info("setErrorCallback() requires a valid callback function"),!1):(this.errorCallback=e,!0)}},{key:"_debugCallbackRegistration",value:function(){var e=this;this._config.debug&&(this._plugin.on("registration",function(t){e._token=new c.Token(t.registrationId),e.logger.info("device token registered",e._token)}),this._plugin.on("notification",function(t){e._processNotification(t),e.logger.info("notification received",e._notification)}),this._plugin.on("error",function(t){e.logger.error("unexpected error occured."),e.logger.error(t)}))}},{key:"_callbackRegistration",value:function(){var e=this;this._plugin.on("registration",function(t){return e._token=new c.Token(t.registrationId),e.registerCallback?e.registerCallback(t):void 0}),this._plugin.on("notification",function(t){return e._processNotification(t),e.notificationCallback?e.notificationCallback(t):void 0}),this._plugin.on("error",function(){return e.errorCallback?e.errorCallback():void 0})}},{key:"_processNotification",value:function(e){this._notification=e,this._emitter.emit("ionic_push:processNotification",e)}},{key:"_getPushPlugin",value:function(){var e=!1;try{e=window.PushNotification}catch(t){this.logger.info("something went wrong looking for the PushNotification plugin")}return e||!s.IonicPlatform.isIOSDevice()&&!s.IonicPlatform.isAndroidDevice()||self.logger.error("PushNotification plugin is required. Have you run `ionic plugin add phonegap-plugin-push` ?"),e}},{key:"onReady",value:function(e){var t=this;this._isReady?e(t):t._emitter.on("ionic_push:ready",function(){e(t)})}}]),e}();n.Push=h},{"../core/app":11,"../core/core":12,"../core/logger":15,"../core/settings":18,"./push-dev":26,"./push-token":27}]},{},[16,17,14,15,19,18,12,20,11,13,10,27,26,28,25,24,22,23,21,9,8,5,7,6]);